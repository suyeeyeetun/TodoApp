@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "To Do Lists";
}
<body class="bg-light">

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">

                <div class="card shadow">
                    <div class="card-header bg-primary text-white text-center">
                        <h4>📝 To-Do List</h4>
                    </div>

                    <div class="card-body">
                        <!-- Add Todo -->
                        <form action="/Tasks/Create" method="post">
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" name="title" placeholder="Enter a task">
                                <button class="btn btn-primary" id="addBtn">Add</button>
                            </div>
                        </form>

                        <!-- Todo Items -->
                        <ul class="list-group">
                            @foreach (var todo in Model)
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-center">

                                    <!-- LEFT SIDE -->
                                    <form asp-controller="Tasks"
                                          asp-action="ToggleComplete"
                                          asp-route-id="@todo.TodoItemId"
                                          method="post"
                                          class="toggle-form">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@todo.TodoItemId" />

                                        <div class="form-check">
                                            <input class="form-check-input toggle-checkbox"
                                                   type="checkbox"
                                                   @(todo.IsCompleted ? "checked" : "") />

                                            <label class="form-check-label @(todo.IsCompleted ? "text-decoration-line-through text-muted" : "")">
                                                @todo.Title
                                            </label>
                                        </div>

                                    </form>


                                    <!-- RIGHT SIDE -->
                                    <div class="btn-group btn-group-sm">

                                        

                                        <!-- DELETE -->
                                        <form asp-controller="Tasks"
                                              asp-action="Delete"
                                              asp-route-id="@todo.TodoItemId"
                                              method="post">

                                            <button type="submit"
                                                    class="btn btn-outline-danger">
                                                🗑
                                            </button>

                                        </form>

                                    </div>

                                </li>
                            }
                        </ul>


                    </div>

                    
                </div>

            </div>
        </div>
    </div>

</body>

@section Scripts {
    <script>
        document.querySelectorAll(".toggle-checkbox").forEach(cb => {
            cb.addEventListener("change", function () {

                const form = this.closest("form");
                const id = form.querySelector("input[name='id']").value;
                const token = form.querySelector('input[name="__RequestVerificationToken"]').value;
                const label = form.querySelector("label");

                fetch(form.action, {
                    method: "POST",
                    headers: {
                        "RequestVerificationToken": token,
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: new URLSearchParams({ id })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        // toggle line-through instantly
                        label.classList.toggle("text-decoration-line-through");
                        label.classList.toggle("text-muted");
                    }
                });

            });
        });
    </script>
}

